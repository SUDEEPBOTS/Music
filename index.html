<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>VibeFlow - Web Player</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        /* --- CSS: SPOTIFY VIBE --- */
        :root {
            --bg-black: #000000;
            --bg-dark: #121212;
            --bg-light: #242424;
            --primary: #1ed760; /* Spotify Green */
            --text-white: #ffffff;
            --text-gray: #b3b3b3;
        }

        * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Circular', 'Segoe UI', sans-serif; }
        
        body { background-color: var(--bg-black); color: var(--text-white); overflow: hidden; height: 100vh; }

        /* --- LOGIN SCREEN --- */
        #login-section {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: linear-gradient(rgba(0,0,0,0.8), #000), url('https://images.unsplash.com/photo-1493225255756-d9584f8606e9?q=80&w=2070&auto=format&fit=crop');
            background-size: cover;
            display: flex; justify-content: center; align-items: center;
            z-index: 1000;
        }
        .login-box {
            background: var(--bg-black); padding: 40px; border-radius: 10px;
            width: 350px; text-align: center; border: 1px solid #333; box-shadow: 0 0 20px rgba(30, 215, 96, 0.2);
        }
        .login-box h1 { margin-bottom: 30px; color: var(--text-white); }
        .input-group { margin-bottom: 20px; text-align: left; }
        .input-group label { display: block; font-size: 12px; margin-bottom: 5px; color: var(--text-gray); }
        .input-group input {
            width: 100%; padding: 12px; border-radius: 4px; border: 1px solid #555;
            background: var(--bg-light); color: white; outline: none;
        }
        .login-btn {
            width: 100%; padding: 14px; border-radius: 30px; border: none;
            background: var(--primary); color: black; font-weight: bold; font-size: 16px;
            cursor: pointer; transition: 0.2s;
        }
        .login-btn:hover { transform: scale(1.02); background: #1fdf64; }

        /* --- MAIN APP LAYOUT --- */
        #app-section { display: none; height: 100vh; flex-direction: column; }
        
        .main-container { display: flex; flex: 1; overflow: hidden; }
        
        /* Sidebar */
        .sidebar {
            width: 240px; background: var(--bg-black); padding: 20px;
            display: flex; flex-direction: column; gap: 20px;
        }
        .logo { font-size: 24px; font-weight: bold; display: flex; align-items: center; gap: 10px; }
        .nav-item {
            color: var(--text-gray); cursor: pointer; display: flex; align-items: center; gap: 15px;
            font-weight: bold; padding: 10px 0; transition: 0.2s;
        }
        .nav-item:hover, .nav-item.active { color: var(--text-white); }
        
        /* Content Area */
        .content {
            flex: 1; background: linear-gradient(#1f1f1f, #121212);
            margin: 10px; border-radius: 10px; overflow-y: auto; padding: 20px;
            position: relative;
        }

        /* Profile Header */
        .top-bar { display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; }
        .search-bar { display: flex; align-items: center; background: white; border-radius: 50px; padding: 5px 10px; width: 350px; }
        .search-bar input {
            padding: 8px 10px; border: none; width: 100%;
            background: transparent; color: black; outline: none;
        }
        .profile-btn {
            background: rgba(0,0,0,0.7); padding: 5px 15px 5px 5px; border-radius: 20px;
            display: flex; align-items: center; gap: 10px; cursor: pointer;
        }
        .avatar { width: 30px; height: 30px; border-radius: 50%; background: var(--primary); display: flex; justify-content: center; align-items: center; font-weight: bold; color: black;}

        /* Profile Modal */
        #profile-modal {
            position: absolute; top: 60px; right: 20px; background: #282828;
            padding: 15px; border-radius: 8px; box-shadow: 0 5px 15px rgba(0,0,0,0.5);
            display: none; flex-direction: column; gap: 10px; width: 200px; z-index: 200;
        }
        .logout-btn { background: transparent; border: 1px solid var(--text-gray); color: white; padding: 8px; cursor: pointer; border-radius: 4px; }
        .logout-btn:hover { border-color: white; }

        /* Song List */
        .song-list { display: flex; flex-direction: column; gap: 10px; }
        .song-card {
            display: flex; align-items: center; padding: 10px; border-radius: 5px;
            background: rgba(255,255,255,0.05); cursor: pointer; transition: 0.2s;
        }
        .song-card:hover { background: rgba(255,255,255,0.1); }
        .thumb { width: 50px; height: 50px; border-radius: 4px; margin-right: 15px; object-fit: cover;}
        .info { flex: 1; }
        .title { color: white; font-weight: bold; font-size: 14px; margin-bottom: 4px; }
        .artist { color: var(--text-gray); font-size: 12px; }

        /* --- ANIMATIONS (NEW) --- */
        
        /* 1. Shimmer (Skeleton) Animation */
        @keyframes shimmer {
            0% { background-position: -200% 0; }
            100% { background-position: 200% 0; }
        }
        .skeleton {
            background: linear-gradient(90deg, #2a2a2a 25%, #333 50%, #2a2a2a 75%);
            background-size: 200% 100%;
            animation: shimmer 1.5s infinite;
            border-radius: 4px;
        }
        .sk-img { width: 50px; height: 50px; margin-right: 15px; }
        .sk-text { height: 14px; margin-bottom: 5px; width: 60%; }
        .sk-sub { height: 10px; width: 40%; }

        /* 2. Buffering Spinner */
        .loader-spinner {
            border: 3px solid rgba(255,255,255,0.1);
            border-top: 3px solid var(--primary);
            border-radius: 50%;
            width: 30px;
            height: 30px;
            animation: spin 0.8s linear infinite;
            display: none; /* Default hidden */
        }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }


        /* Bottom Player */
        .player-bar {
            height: 90px; background: #181818; border-top: 1px solid #282828;
            display: flex; align-items: center; justify-content: space-between;
            padding: 0 20px; z-index: 100;
        }
        .now-playing { display: flex; align-items: center; width: 30%; }
        .np-img { width: 56px; height: 56px; border-radius: 4px; margin-right: 15px; background: #333; display: none; }
        
        .controls { display: flex; flex-direction: column; align-items: center; width: 40%; }
        .buttons { display: flex; gap: 20px; align-items: center; margin-bottom: 5px; }
        .btn-icon { background: none; border: none; color: var(--text-gray); font-size: 18px; cursor: pointer; transition: 0.2s;}
        .btn-icon:hover { color: white; }
        
        /* Play Button Container to hold icon or spinner */
        .play-btn-container {
            width: 40px; height: 40px; background: white; border-radius: 50%;
            display: flex; justify-content: center; align-items: center; cursor: pointer;
        }
        .play-btn-container:hover { transform: scale(1.05); }
        .play-icon { font-size: 18px; color: black; margin-left: 2px; } /* Correction for visual center */
        .pause-icon { font-size: 18px; color: black; }

        video { display: none; } /* Hidden Audio Player */

        /* Responsive */
        @media (max-width: 768px) {
            .sidebar { display: none; } 
            .now-playing { width: 40%; }
            .search-bar { width: 200px; }
        }
    </style>
</head>
<body>

    <div id="login-section">
        <div class="login-box">
            <h1><i class="fab fa-spotify" style="color:var(--primary);"></i> VibeFlow</h1>
            <div class="input-group">
                <label>Email address</label>
                <input type="email" id="emailInput" placeholder="name@domain.com">
            </div>
            <div class="input-group">
                <label>Password</label>
                <input type="password" id="passInput" placeholder="Password">
            </div>
            <button class="login-btn" onclick="handleLogin()">LOG IN</button>
            <p style="margin-top:15px; color:#aaa; font-size:12px;">(Simulated OTP: 1234)</p>
        </div>
    </div>

    <div id="app-section" style="display: none;">
        <div class="main-container">
            <div class="sidebar">
                <div class="logo"><i class="fab fa-spotify" style="color:white;"></i> VibeFlow</div>
                <div class="nav-item active"><i class="fas fa-home"></i> Home</div>
                <div class="nav-item"><i class="fas fa-search"></i> Search</div>
                <div class="nav-item"><i class="fas fa-book"></i> Your Library</div>
                <div style="margin-top:20px;"></div>
                <div class="nav-item"><i class="fas fa-plus-square"></i> Create Playlist</div>
                <div class="nav-item"><i class="fas fa-heart"></i> Liked Songs</div>
            </div>

            <div class="content">
                <div class="top-bar">
                    <div class="search-bar">
                        <i class="fas fa-search" style="color:black; margin-right:5px;"></i>
                        <input type="text" id="searchInput" placeholder="Search songs, artists..." onkeypress="handleEnter(event)">
                    </div>
                    
                    <div style="position: relative;">
                        <div class="profile-btn" onclick="toggleProfile()">
                            <div class="avatar" id="userAvatar">U</div>
                            <span id="userNameDisplay" style="font-weight:bold; font-size:14px; margin-right:5px;">User</span>
                            <i class="fas fa-caret-down"></i>
                        </div>
                        <div id="profile-modal">
                            <p style="font-size:12px; color:#aaa;" id="userEmailDisplay">user@gmail.com</p>
                            <hr style="border:0; border-top:1px solid #444;">
                            <button class="logout-btn" onclick="handleLogout()">Log out</button>
                        </div>
                    </div>
                </div>

                <h2 style="margin-bottom: 20px;">Results</h2>
                <div class="song-list" id="feed">
                    <p style="color:#777;">Search to start listening...</p>
                </div>
            </div>
        </div>

        <div class="player-bar">
            <div class="now-playing">
                <img src="" id="np-img" class="np-img">
                <div>
                    <div id="np-title" style="color:white; font-size:14px; font-weight:bold;">Not Playing</div>
                    <div id="np-artist" style="color:#b3b3b3; font-size:11px;"></div>
                </div>
            </div>
            <div class="controls">
                <div class="buttons">
                    <button class="btn-icon" onclick="seek(-10)"><i class="fas fa-step-backward"></i></button>
                    
                    <div class="play-btn-container" onclick="togglePlay()">
                        <i class="fas fa-play play-icon" id="playIcon"></i>
                        <div class="loader-spinner" id="bufferingSpinner"></div>
                    </div>

                    <button class="btn-icon" onclick="seek(10)"><i class="fas fa-step-forward"></i></button>
                </div>
                <div style="width: 100%; height: 4px; background: #555; border-radius: 2px; margin-top:5px; position:relative;">
                    <div id="progressBar" style="width: 0%; height: 100%; background: var(--text-white); border-radius: 2px;"></div>
                </div>
            </div>
            <div style="width:30%;"></div>
        </div>
    </div>

    <video id="audioPlayer"></video>

    <script>
        // --- AUTH LOGIC ---
        window.onload = function() {
            const user = localStorage.getItem('vibeUser');
            if (user) showApp(JSON.parse(user));
            else {
                document.getElementById('login-section').style.display = 'flex';
                document.getElementById('app-section').style.display = 'none';
            }
        };

        function handleLogin() {
            const email = document.getElementById('emailInput').value;
            const pass = document.getElementById('passInput').value;
            if (email && pass) {
                const otp = prompt(`OTP sent to ${email}\nEnter 1234:`);
                if(otp === "1234") {
                    const userData = { email: email, name: email.split('@')[0], isLoggedIn: true };
                    localStorage.setItem('vibeUser', JSON.stringify(userData));
                    showApp(userData);
                } else alert("Wrong OTP!");
            } else alert("Details missing!");
        }

        function handleLogout() {
            localStorage.removeItem('vibeUser');
            location.reload();
        }

        function showApp(user) {
            document.getElementById('login-section').style.display = 'none';
            document.getElementById('app-section').style.display = 'flex';
            document.getElementById('userNameDisplay').innerText = user.name;
            document.getElementById('userAvatar').innerText = user.name.charAt(0).toUpperCase();
            document.getElementById('userEmailDisplay').innerText = user.email;
        }

        function toggleProfile() {
            const modal = document.getElementById('profile-modal');
            modal.style.display = modal.style.display === 'flex' ? 'none' : 'flex';
        }

        function handleEnter(e) {
            if(e.key === 'Enter') searchSong();
        }

        // --- MUSIC LOGIC WITH ANIMATIONS ---

        const player = document.getElementById('audioPlayer');
        const feed = document.getElementById('feed');
        const playIcon = document.getElementById('playIcon');
        const spinner = document.getElementById('bufferingSpinner');
        const progressBar = document.getElementById('progressBar');

        async function searchSong() {
            const query = document.getElementById('searchInput').value;
            if(!query) return;

            // 1. SHOW SKELETON LOADER (Structure Loading)
            let skeletonHTML = '';
            for(let i=0; i<3; i++) {
                skeletonHTML += `
                    <div class="song-card" style="pointer-events: none;">
                        <div class="skeleton sk-img"></div>
                        <div class="info">
                            <div class="skeleton sk-text"></div>
                            <div class="skeleton sk-sub"></div>
                        </div>
                    </div>
                `;
            }
            feed.innerHTML = skeletonHTML;

            const apiKey = "YUKI-D48896353AE8";
            
            // ðŸ”¥ UPDATE: PROXY USE KAR RAHE HAIN (CORS FIX)
            const targetUrl = `https://fastapi2-wdtl.onrender.com/getvideo?query=${encodeURIComponent(query)}&key=${apiKey}`;
            const url = `https://api.allorigins.win/raw?url=${encodeURIComponent(targetUrl)}`;

            try {
                const res = await fetch(url);
                const data = await res.json();

                if(data.status === 200) {
                    // 2. DATA LOADED - Show Real Content
                    const newSongHTML = `
                        <div class="song-card" onclick="playSong('${data.link}', '${data.title}', '${data.thumbnail}')">
                            <img src="${data.thumbnail}" class="thumb">
                            <div class="info">
                                <div class="title">${data.title}</div>
                                <div class="artist">Duration: ${data.duration}</div>
                            </div>
                            <i class="fas fa-play-circle" style="color:#1ed760; font-size:24px;"></i>
                        </div>
                    `;
                    
                    feed.innerHTML = newSongHTML;
                    
                } else {
                    feed.innerHTML = '<p>Song not found.</p>';
                }
            } catch (e) {
                console.log(e);
                feed.innerHTML = '<p>Error fetching song (Check Console).</p>';
            }
        }

        function playSong(link, title, thumbnail) {
            // Player UI Update
            document.getElementById('np-img').src = thumbnail;
            document.getElementById('np-img').style.display = "block";
            document.getElementById('np-title').innerText = title.substring(0,25) + "...";
            document.getElementById('np-artist').innerText = "Now Playing";
            
            // Set Source & Play
            player.src = link;
            player.play();
        }

        function togglePlay() {
            if(player.paused) player.play();
            else player.pause();
        }

        function seek(sec) {
            player.currentTime += sec;
        }

        // --- PLAYER EVENTS FOR BUFFERING ANIMATION ---

        player.addEventListener('waiting', () => {
            playIcon.style.display = 'none';
            spinner.style.display = 'block'; 
        });

        player.addEventListener('playing', () => {
            spinner.style.display = 'none'; 
            playIcon.style.display = 'block';
            playIcon.classList.remove('fa-play');
            playIcon.classList.add('fa-pause');
            playIcon.style.marginLeft = "0"; 
        });

        player.addEventListener('pause', () => {
            spinner.style.display = 'none';
            playIcon.style.display = 'block';
            playIcon.classList.remove('fa-pause');
            playIcon.classList.add('fa-play');
            playIcon.style.marginLeft = "2px"; 
        });

        player.addEventListener('timeupdate', () => {
            if(player.duration) {
                const percent = (player.currentTime / player.duration) * 100;
                progressBar.style.width = percent + "%";
            }
        });

    </script>
</body>
</html>
